<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Championship Checkpoint Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    #camera {
      width: 320px;
      margin: auto;
    }
    .result-card {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 12px;
      text-align: center;
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
      background: #f3f4f6;
    }
    .result-card img {
      width: 80px; height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 0.5rem;
      border: 3px solid #2563eb;
    }
    .name {
      font-size: 1rem;
      font-weight: bold;
      word-break: break-word;    /* long names wrap */
      white-space: normal;       /* allow multiple lines */
    }
    .role {
      display: inline-block;
      margin-top: 4px;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      color: #fff;
      background: #2563eb;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-xl font-bold mb-4">✅ Championship Checkpoint Scanner</h1>

  <!-- Camera -->
  <div id="camera"></div>

  <!-- Result Card -->
  <div id="result" class="result-card hidden"></div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDaHqgItxdKb-wQhjRX4mD-4yFyc2sfroE",
    authDomain: "championship-app-4cbd4.firebaseapp.com",
    databaseURL: "https://championship-app-4cbd4-default-rtdb.firebaseio.com",
    projectId: "championship-app-4cbd4",
    storageBucket: "championship-app-4cbd4.appspot.com",
    messagingSenderId: "509794140861",
    appId: "1:509794140861:web:1a3f944428143af9c2add4"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Start scanner
  const html5QrCode = new Html5Qrcode("camera");
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 200 },
    qrCodeMessage => { verifyUser(qrCodeMessage); }
  );

  async function verifyUser(id) {
    const snap = await db.ref("users/"+id).get();
    const res = document.getElementById("result");
    res.innerHTML = "";
    if(snap.exists()){
      const u = snap.val();
      res.classList.remove("hidden");
      res.style.background = "#d1fae5"; // green if valid
      res.innerHTML = `
        <img src="${u.photo || ''}" alt="Photo"/>
        <div class="name">${u.name}</div>
        <div class="role">${u.role}</div>
        <div class="text-sm text-gray-700">${u.dojo || ""}</div>
        <div class="text-xs text-gray-500 mt-1">ID: ${u.id}</div>
      `;
    } else {
      res.classList.remove("hidden");
      res.style.background = "#fee2e2"; // red if invalid
      res.innerHTML = `<div class="name text-red-700">❌ Invalid ID</div>`;
    }
  }
</script>
</body>
</html>
